<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fusion Hub Premium</title>
    <style>
        :root {
            --bg-start: #0f172a;
            --bg-end: #1e293b;
            --card-bg: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            --card-glow: rgba(34, 197, 94, 0.5);
            --text-color: #e5e7eb;
            --accent-color: #22c55e;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            --glow: 0 0 10px rgba(34, 197, 94, 0.5);
            --border: 1px solid rgba(34, 197, 94, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        #particles {
            position: fixed;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0;
            animation: fadeInParticles 0.4s ease-out 0s forwards;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            height: 100vh;
            padding: 10px;
            max-width: 1200px;
            margin: 0 auto;
            opacity: 0;
            animation: fadeInContainer 0.25s ease-out forwards;
        }

        h1 {
            font-size: calc(2rem + 1vw);
            font-weight: 700;
            background: linear-gradient(90deg, #22c55e, #86efac);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: calc(2vh) 0;
            will-change: transform, opacity;
            opacity: 0;
            transform: translateY(-20px);
            animation: fadeInTitle 0.5s ease-out 0.2s forwards;
        }

        #dateTime {
            font-size: calc(0.8rem + 0.5vw);
            color: #d1d5db;
            background: linear-gradient(90deg, #22c55e, #86efac);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: calc(1vh);
            opacity: 0;
            transform: translateY(-10px);
            animation: fadeInTitle 0.5s ease-out 0.3s forwards;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0;
            width: 100%;
            max-height: calc(100vh - 170px);
            height: auto;
            padding: 0;
            justify-items: stretch;
        }

        .app-item {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: var(--border);
            border-radius: 12px;
            padding: calc(10px + 0.3vw);
            text-align: center;
            box-shadow: var(--shadow), inset 0 0 5px rgba(34, 197, 94, 0.3);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease, filter 0.3s ease;
            transform: perspective(800px) rotateX(-8deg) rotateY(8deg) scale(0.8);
            will-change: transform, opacity, filter;
            opacity: 0;
            animation: unfoldCard 0.4s ease-out var(--delay) forwards;
            width: 100%;
            height: calc(80px + 0.5vw);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .app-item:hover {
            transform: perspective(800px) rotateX(5deg) rotateY(-5deg) scale(1.02) translateY(-3px);
            box-shadow: var(--glow), inset 0 0 5px rgba(34, 197, 94, 0.3);
            filter: brightness(1.1);
        }

        .app-item:hover span {
            color: #86efac;
        }

        .app-item:active {
            transform: perspective(800px) rotateX(0deg) rotateY(0deg) scale(0.97);
            animation: pulse 0.3s ease-out;
        }

        .app-item img {
            width: calc(28px + 0.5vw);
            height: calc(28px + 0.5vw);
            margin-bottom: calc(4px + 0.3vw);
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .app-item:hover img {
            transform: scale(1.1);
        }

        .app-item span {
            font-size: calc(0.9rem + 0.2vw);
            font-weight: 600;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        #fusionBot {
            position: fixed;
            bottom: calc(70px + 2vh);
            right: calc(10px + 1vw);
            width: calc(60px + 2vw);
            height: calc(60px + 2vw);
            background: radial-gradient(circle, #22c55e, #1e293b);
            border-radius: 50%;
            box-shadow: var(--glow);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transform: scale(0.5);
            animation: popInBot 0.5s ease-out 0.7s forwards, float 2s ease-in-out infinite 1.2s;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        #fusionBot:hover {
            transform: scale(1.1);
        }

        #fusionBot img {
            width: calc(40px + 2vw);
            height: calc(40px + 2vw);
        }

        #speechBubble {
            position: fixed;
            bottom: calc(140px + 2vh);
            right: calc(80px + 2vw);
            max-width: calc(240px + 5vw);
            padding: calc(8px + 1vw) calc(12px + 1vw);
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(12px);
            border: var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow);
            font-size: calc(0.7rem + 0.5vw);
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 999;
        }

        #speechBubble.active {
            opacity: 1;
            transform: translateY(0);
        }

        #chatPanel {
            position: fixed;
            bottom: calc(10px + 1vh);
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            width: calc(100% - 20px);
            max-width: calc(360px + 5vw);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: var(--border);
            border-radius: 20px;
            padding: calc(8px + 1vw);
            box-shadow: var(--shadow);
            z-index: 1001;
            opacity: 0;
            animation: slideUpPanel 0.5s ease-out 0.5s forwards;
        }

        #chatInput {
            width: 100%;
            padding: calc(6px + 1vw) calc(10px + 1vw);
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            font-size: calc(0.7rem + 0.5vw);
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.2);
            outline: none;
            transition: box-shadow 0.3s ease;
        }

        #chatInput:focus {
            box-shadow: 0 0 8px var(--card-glow);
        }

        #buttonContainer {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-top: calc(6px + 1vw);
        }

        #sendBtn, #micToggleBtn {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow), inset 0 0 5px rgba(34, 197, 94, 0.3);
            color: var(--text-color);
            font-size: calc(0.9rem + 0.2vw);
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease, filter 0.3s ease;
            transform: perspective(800px) rotateX(-8deg) rotateY(8deg);
            width: calc(80px + 0.5vw);
            height: calc(60px + 0.5vw);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #sendBtn:hover, #micToggleBtn:hover {
            transform: perspective(800px) rotateX(5deg) rotateY(-5deg) scale(1.02) translateY(-3px);
            box-shadow: var(--glow), inset 0 0 5px rgba(34, 197, 94, 0.3);
            filter: brightness(1.1);
        }

        #sendBtn:hover, #micToggleBtn:hover {
            color: #86efac;
        }

        #micToggleBtn.listening {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
        }

        #micToggleBtn::before {
            content: 'üéôÔ∏è';
            margin-right: calc(4px + 0.5vw);
        }

        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        #loadingOverlay.active {
            opacity: 1;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(34, 751, 94, 0.3);
            border-top: 4px solid #22c55e;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes fadeInParticles { to { opacity: 1; } }
        @keyframes fadeInContainer { to { opacity: 1; } }
        @keyframes fadeInTitle { to { opacity: 1; transform: translateY(0); } }
        @keyframes unfoldCard { to { opacity: 1; transform: perspective(800px) rotateX(0deg) rotateY(0deg) scale(1); } }
        @keyframes pulse { 0% { transform: perspective(800px) scale(0.97); } 50% { transform: perspective(800px) scale(1.03); } 100% { transform: perspective(800px) scale(1); } }
        @keyframes popInBot { to { opacity: 1; transform: scale(1); } }
        @keyframes slideUpPanel { to { opacity: 1; transform: translateX(-50%) translateY(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes spin { to { transform: rotate(360deg); } }

        .app-item:nth-child(1) { --delay: 0.3s; }
        .app-item:nth-child(2) { --delay: 0.4s; }
        .app-item:nth-child(3) { --delay: 0.5s; }
        .app-item:nth-child(4) { --delay: 0.6s; }
        .app-item:nth-child(5) { --delay: 0.7s; }
        .app-item:nth-child(6) { --delay: 0.8s; }

        @media (max-width: 768px) {
            .app-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0;
                max-height: calc(100vh - 160px);
                padding: 0;
            }

            h1 { font-size: calc(1.8rem + 1vw); }

            #dateTime { font-size: calc(0.7rem + 0.5vw); }

            #chatPanel { max-width: calc(100% - 20px); }

            #fusionBot {
                width: calc(55px + 2vw);
                height: calc(55px + 2vw);
                bottom: calc(65px + 2vh);
                right: calc(8px + 1vw);
            }

            #fusionBot img { width: calc(35px + 2vw); height: calc(35px + 2vw); }

            #speechBubble {
                max-width: calc(180px + 5vw);
                right: calc(70px + 2vw);
                bottom: calc(130px + 2vh);
            }

            .app-item {
                height: calc(75px + 0.5vw);
            }

            .app-item img {
                width: calc(26px + 0.5vw);
                height: calc(26px + 0.5vw);
            }

            .app-item span {
                font-size: calc(0.8rem + 0.2vw);
            }

            #sendBtn, #micToggleBtn {
                width: calc(75px + 0.5vw);
                height: calc(55px + 0.5vw);
                font-size: calc(0.8rem + 0.2vw);
            }
        }

        @media (max-width: 480px) {
            .app-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0;
                max-height: calc(100vh - 150px);
                padding: 0;
            }

            h1 { font-size: calc(1.6rem + 1vw); }

            #dateTime { font-size: calc(0.6rem + 0.5vw); }

            .app-item {
                height: calc(70px + 0.5vw);
            }

            .app-item img {
                width: calc(24px + 0.5vw);
                height: calc(24px + 0.5vw);
            }

            .app-item span {
                font-size: calc(0.7rem + 0.2vw);
            }

            #sendBtn, #micToggleBtn {
                width: calc(70px + 0.5vw);
                height: calc(50px + 0.5vw);
                font-size: calc(0.7rem + 0.2vw);
            }
        }
    </style>
</head>
<body>
    <canvas id="particles"></canvas>
    <div class="container">
        <h1>Welcome to Fusion Hub Premium</h1>
        <div id="dateTime"></div>
        <div class="app-grid">
            <div class="app-item" data-url="https://chat.openai.com/">
                <img src="gpt.png" alt="ChatGPT">
                <span>ChatGPT</span>
            </div>
            <div class="app-item" data-url="https://open.spotify.com/">
                <img src="music.png" alt="Music">
                <span>Music</span>
            </div>
            <div class="app-item" data-url="https://crazygames.com/">
                <img src="games.jpg" alt="Games">
                <span>Game Server 1</span>
            </div>
            <div class="app-item" data-url="https://poki.com/">
                <img src="games.jpg" alt="Games">
                <span>Game Server 2</span>
            </div>
            <div class="app-item" data-url="https://aniplaynow.live/">
                <img src="anime.png" alt="Anime">
                <span>Anime</span>
            </div>
            <div class="app-item" data-url="https://app.kosmi.io/">
                <img src="wt.jpg" alt="Watch Together">
                <span>Watch Together</span>
            </div>
        </div>
    </div>

    <div id="speechBubble"></div>
    <div id="chatPanel">
        <input type="text" id="chatInput" placeholder="Ask FusionBot...">
        <div id="buttonContainer">
            <button id="sendBtn">Send</button>
            <button id="micToggleBtn">On</button>
        </div>
    </div>
    <div id="fusionBot">
        <img src="ai.gif" alt="FusionBot AI Assistant">
    </div>
    <div id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script>
        // Particle Background and Burst
        const canvas = document.getElementById('particles');
        const ctx = canvas.getContext('2d');
        if (canvas && ctx) {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particlesArray = [];
            class Particle {
                constructor(x, y, isBurst = false) {
                    this.x = x || Math.random() * canvas.width;
                    this.y = y || Math.random() * canvas.height;
                    this.size = isBurst ? Math.random() * 3 + 1 : Math.random() * 1.2 + 0.3;
                    this.speedX = isBurst ? Math.random() * 10 - 5 : Math.random() * 0.2 - 0.1;
                    this.speedY = isBurst ? Math.random() * 10 - 5 : Math.random() * 0.2 - 0.1;
                    this.opacity = isBurst ? 0.8 : 0.2;
                    this.isBurst = isBurst;
                }
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    if (this.isBurst) {
                        this.opacity -= 0.02;
                        this.size -= 0.05;
                    } else if (this.size > 0.2) {
                        this.size -= 0.015;
                    }
                }
                draw() {
                    ctx.fillStyle = `rgba(34, 197, 94, ${this.opacity})`;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            function initParticles() {
                for (let i = 0; i < 12; i++) particlesArray.push(new Particle());
            }

            function createBurst(x, y) {
                for (let i = 0; i < 20; i++) particlesArray.push(new Particle(x, y, true));
            }

            function animateParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particlesArray.forEach((p, i) => {
                    p.update();
                    p.draw();
                    if (p.size <= 0.2 || (p.isBurst && p.opacity <= 0)) {
                        particlesArray.splice(i, 1);
                        if (!p.isBurst) particlesArray.push(new Particle());
                    }
                });
                requestAnimationFrame(animateParticles);
            }

            initParticles();
            animateParticles();

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        } else {
            console.error('Canvas or context not found');
        }

        // App Open Function
        function openApp(element, url) {
            console.log('Opening app:', url);
            const rect = element.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            createBurst(x, y);
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.add('active');
            setTimeout(() => {
                try {
                    const newWindow = window.open(url, '_blank');
                    if (!newWindow) {
                        console.error('Failed to open URL:', url, 'Popup blocker may be enabled.');
                        alert('Failed to open the app. Please allow popups and try again.');
                    } else {
                        console.log('Successfully opened URL:', url);
                    }
                    overlay.classList.remove('active');
                } catch (error) {
                    console.error('Error opening URL:', url, error);
                    alert('Error opening the app. Check console for details.');
                    overlay.classList.remove('active');
                }
            }, 800);
        }

        // Chatbot Logic
        document.addEventListener('DOMContentLoaded', () => {
            const bubble = document.getElementById('speechBubble');
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            const micToggleBtn = document.getElementById('micToggleBtn');
            const fusionBot = document.getElementById('fusionBot');
            const dateTime = document.getElementById('dateTime');

            if (!bubble || !chatInput || !sendBtn || !micToggleBtn || !fusionBot || !dateTime) {
                console.error('Missing DOM elements:', { bubble, chatInput, sendBtn, micToggleBtn, fusionBot, dateTime });
                alert('Error: Some interface elements failed to load. Check console for details.');
                return;
            }

            // Display and Update Date and Time
            const getIndiaTime = () => {
                return new Date().toLocaleString('en-US', {
                    timeZone: 'Asia/Kolkata',
                    weekday: 'long',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true
                });
            };

            // Initial set and auto-update every second
            dateTime.textContent = getIndiaTime();
            setInterval(() => {
                dateTime.textContent = getIndiaTime();
            }, 1000);

            // Add click event listeners to app items
            document.querySelectorAll('.app-item').forEach(item => {
                const url = item.dataset.url;
                if (url) {
                    item.addEventListener('click', () => {
                        console.log('App item clicked:', url);
                        openApp(item, url);
                    });
                } else {
                    console.error('No URL found for app item:', item);
                }
            });

            let userName = localStorage.getItem('userName') || '';
            let isFirstMessage = !userName;
            let isSettingUp = false;
            let isMicListening = false;
            let isWakeWordDetected = false;

            const urls = {
                chatgpt: "https://chat.openai.com/",
                music: "https://open.spotify.com/",
                "game server 1": "https://crazygames.com/",
                "game server 2": "https://poki.com/",
                anime: "https://aniplaynow.live/",
                "watch together": "https://app.kosmi.io/"
            };

            const showBubble = (text) => {
                bubble.textContent = text;
                bubble.classList.add('active');
                setTimeout(() => bubble.classList.remove('active'), 3500);
            };

            const handleCommand = (input) => {
                const lowerInput = input.toLowerCase().trim();
                if (isFirstMessage) {
                    isFirstMessage = false;
                    isSettingUp = true;
                    return "Please enter your name:";
                }
                if (isSettingUp) {
                    if (lowerInput) {
                        userName = lowerInput;
                        localStorage.setItem('userName', userName);
                        isSettingUp = false;
                        return `Welcome, ${userName}! Say "hey TPG" or type 'help' for commands.`;
                    }
                    return "Please enter a valid name:";
                }
                if (lowerInput.includes("time") || lowerInput.includes("what time")) return `Current time: ${getIndiaTime()}`;
                if (lowerInput.includes("weather")) return "For June 11, 2025, in India, expect warm summer weather, around 30-38¬∞C, with possible monsoon showers.";
                if (lowerInput.includes("fact")) return "Octopuses have three hearts.";
                if (["hello", "hi", "hey", "hola"].includes(lowerInput)) return `Hey ${userName}, what's up?`;
                if (lowerInput === "joke" || lowerInput.includes("tell me a joke")) return "Why don‚Äôt eggs tell jokes? They‚Äôd crack up!";
                if (lowerInput === "help") return "Commands: hello/hi/hey/hola, time, weather, fact, joke, help, open [chatgpt/music/game server 1/game server 2/anime/watch together]";
                if (lowerInput.startsWith("open ")) {
                    const link = lowerInput.replace("open ", "");
                    if (urls[link]) {
                        const appItem = document.querySelector(`.app-item[data-url="${urls[link]}"]`);
                        if (appItem) {
                            console.log('Chatbot opening app:', urls[link]);
                            openApp(appItem, urls[link]);
                        } else {
                            console.error('App item not found for URL:', urls[link]);
                            try {
                                window.open(urls[link], '_blank');
                            } catch (error) {
                                console.error('Failed to open URL via chatbot:', urls[link], error);
                                return "Error opening the app. Check console for details.";
                            }
                        }
                        return `Opening ${link}...`;
                    }
                    return "Invalid link. Try: chatgpt, music, game server 1, game server 2, anime, watch together.";
                }
                if (lowerInput === "i am good") return `Glad to hear that, ${userName}! What's next?`;
                return `You said: ${input}. Try 'help' for commands.`;
            };

            const sendMessage = () => {
                const message = chatInput.value.trim();
                if (!message) return showBubble("Type a message.");
                chatInput.value = '';
                showBubble('Processing...');
                setTimeout(() => showBubble(handleCommand(message)), 500);
            };

            let timeout;
            const debounce = (fn, delay) => {
                clearTimeout(timeout);
                timeout = setTimeout(fn, delay);
            };

            sendBtn.addEventListener('click', () => debounce(sendMessage, 100));
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') debounce(sendMessage, 100);
            });

            fusionBot.addEventListener('click', () => showBubble('Ask me anything!'));

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;
            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.lang = 'en-US';
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    if (!isMicListening) return;
                    const result = event.results[0][0].transcript.trim().toLowerCase();
                    if (["hey tpg", "tpg", "fusionhub"].includes(result)) {
                        isWakeWordDetected = true;
                        return showBubble('Say your command...');
                    }
                    if (isWakeWordDetected) {
                        chatInput.value = result;
                        showBubble('Processing...');
                        setTimeout(() => showBubble(handleCommand(result)), 500);
                        isWakeWordDetected = false;
                    }
                };

                recognition.onerror = (event) => {
                    showBubble(event.error === 'no-speech' ? 'No speech detected.' : 'Speech error.');
                    console.error('Speech recognition error:', event.error);
                };

                recognition.onend = () => {
                    if (isMicListening) {
                        try {
                            recognition.start();
                        } catch (error) {
                            console.error('Failed to restart recognition:', error);
                            isMicListening = false;
                            micToggleBtn.textContent = 'On';
                            micToggleBtn.classList.remove('listening');
                            showBubble('Mic error. Try again.');
                        }
                    }
                };

                micToggleBtn.addEventListener('click', () => {
                    isMicListening = !isMicListening;
                    if (isMicListening) {
                        try {
                            recognition.start();
                            micToggleBtn.textContent = 'Off';
                            micToggleBtn.classList.add('listening');
                            showBubble('Listening...');
                        } catch (error) {
                            console.error('Failed to start recognition:', error);
                            showBubble('Mic failed to start.');
                            isMicListening = false;
                        }
                    } else {
                        recognition.stop();
                        micToggleBtn.textContent = 'On';
                        micToggleBtn.classList.remove('listening');
                        showBubble('Mic off.');
                    }
                });
            } else {
                micToggleBtn.disabled = true;
                micToggleBtn.textContent = 'üéôÔ∏è';
                showBubble('Speech not supported.');
                console.warn('SpeechRecognition API not supported in this browser.');
            }

            setTimeout(() => showBubble(userName ? `Hey ${userName}, ready to go?` : 'Type your name to start!'), 1000);
        });
    </script>
</body>
</html>
